<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Julian Huber" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Funktionen - Bussysteme</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Funktionen";
        var mkdocs_page_input_path = "2_3_Funktionen.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Bussysteme
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">√úbersicht</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Geb√§udeautomation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../1_1_Geb%C3%A4udeautomation/">Geb√§udeautomation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1_2_Planungsabl%C3%A4ufe/">Planungsabl√§ufe</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Computer-Systeme</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../2_1_Messkette/">Messkette</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../2_2_Steuerung/">Steuerung</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Funktionen</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../2_4_Objektorientierung/">Objektorientierung</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Regelungstechnik</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../3_1_Blockschaltbild/">Blockschaltbild </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../3_2_Regelkreis/">Regelkreis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../3_3_Regelverhalten/">Regelverhalten</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Speicherprogrammierbare Steuerung</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../4_1_Speicherprogrammierbare_Steuerung/">Speicherprogrammierbare Steuerung</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../4_2_Sprachen_nach_IEC_61131-3/">Sprachen nach IEC 61131-3</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Bussysteme</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../5_1_Bussysteme/">Bussysteme</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../5_2_Theoretische_Grundlagen/">Theoretische Grundlagen</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../5_3_Feldbusse/">Feldbusse</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../5_4_Bussysteme_in_der_Geb%C3%A4udeautomation/">Bussysteme in der Geb√§udeautomation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../5_5_Bussysteme_in_der_MSR-Technik/">Bussysteme in der MSR-Technik</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Smart Metering</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../6_1_Smart_Metering/">Smart Metering</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Bussysteme</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Computer-Systeme</li>
      <li class="breadcrumb-item active">Funktionen</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <!-- paginate: true -->

<h1 id="bussysteme">Bussysteme</h1>
<p><strong>SoSe 2023</strong>
Dr. Julian Huber</p>
<hr />
<h1 id="funktionen">Funktionen</h1>
<h2 id="funktionale-programmierung">Funktionale Programmierung</h2>
<ul>
<li>Berechnung von Output aus Input wird in wieder aufrufbaren Funktionen gekapselt</li>
<li>Funktion hat nur Input und Output aber keinen Speicher / Zustand </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># 3</span>
<span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="c1"># 7</span>
</code></pre></div>
<hr />
<h2 id="steuerfunktion">Steuerfunktion</h2>
<div class="arithmatex">\[L_{\text{SET}} = (P_{\text{ACT}} \land (H_{\text{ROOM}} &lt; \text{PAR}_{\text{SETPT}})) \lor  L_{\text{MAN}})\]</div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">l_set</span><span class="p">(</span><span class="n">p_act</span><span class="p">,</span> <span class="n">h_room</span><span class="p">,</span> <span class="n">PAR_SETPT</span><span class="p">,</span> <span class="n">l_man</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p_act</span> <span class="ow">and</span> <span class="n">h_room</span><span class="o">&lt;</span><span class="n">PAR_SETPT</span><span class="p">)</span> <span class="ow">or</span> <span class="n">l_man</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tageslichtschaltung</span> <span class="kn">import</span> <span class="n">l_set</span>
<span class="kn">from</span> <span class="nn">mapping</span> <span class="kn">import</span> <span class="n">map_quat</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">l_set_value</span> <span class="o">=</span> <span class="n">l_set</span><span class="p">(</span><span class="n">p_act</span><span class="p">,</span> <span class="n">h_room</span><span class="p">,</span> <span class="n">PAR_SETPT</span><span class="p">,</span> <span class="n">l_man</span><span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="aufgabe-2_3_1-implementierung-einer-tageslichtschaltung"><img alt="‚úç" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/270d.svg" title=":writing_hand:" /> Aufgabe 2_3_1: Implementierung einer Tageslichtschaltung</h3>
<ul>
<li>Implementieren Sie die Tageslichtschaltung in Python</li>
<li>Stellen Sie zun√§chst sicher, dass LED, Button und Analog-Digital-Wandler korrekt angeschlossen sind</li>
<li>Setzen Sie die manuelle Einstellung <code>l_man</code> dauerhaft auf <code>False</code> </li>
<li>Setzen Sie den Sollwert <code>PAR_SETPT</code> auf einen geigneten Wert</li>
<li>Legen Sie die beiden Module <code>tageslichtschaltung.py</code> und <code>mappings.py</code> in den gleichen Ordner wie Ihre Hauptdatei</li>
<li><img alt="ü§ì" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f913.svg" title=":nerd_face:" /> Recherchieren Sie einen geeigneten Sensor, den Sie f√ºr die Anwesenheitserkennung verwenden k√∂nnen</li>
</ul>
<hr />
<h4 id="moglicher-startpunkt">M√∂glicher Startpunkt</h4>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">board</span>
<span class="kn">import</span> <span class="nn">analogio</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">mappings</span> <span class="kn">import</span> <span class="n">map_quat</span>
<span class="kn">from</span> <span class="nn">tageslichtschaltung</span> <span class="kn">import</span> <span class="n">l_set</span>
<span class="kn">import</span> <span class="nn">digitalio</span>

<span class="c1"># Initialisierung des ADC (Analog-Digital Converter)</span>
<span class="n">ldr</span> <span class="o">=</span> <span class="n">analogio</span><span class="o">.</span><span class="n">AnalogIn</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">A2</span><span class="p">)</span>

<span class="c1"># Initialisierung der LED</span>
<span class="n">led_pin</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">GP1</span>      <span class="c1"># Replace with the GPIO pin connected to your LED</span>
<span class="n">led</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">led_pin</span><span class="p">)</span>
<span class="n">led</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">Direction</span><span class="o">.</span><span class="n">OUTPUT</span>

<span class="c1"># Initialisierung Button</span>
<span class="n">button_pin</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">GP0</span>  <span class="c1"># Replace with the GPIO pin connected to your button</span>
<span class="n">button</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">button_pin</span><span class="p">)</span>
<span class="n">button</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">Direction</span><span class="o">.</span><span class="n">INPUT</span>
<span class="n">button</span><span class="o">.</span><span class="n">pull</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">Pull</span><span class="o">.</span><span class="n">UP</span>  <span class="c1"># Use pull-up resistor; change if using pull-down</span>


<span class="c1"># Parameter setzen</span>
<span class="n">PAR_SETPT</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">l_man</span> <span class="o">=</span> <span class="kc">False</span>


<span class="c1"># Wiederholung</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># ADC als Dezimalzahl lesen</span>
    <span class="n">read</span> <span class="o">=</span> <span class="n">ldr</span><span class="o">.</span><span class="n">value</span>
    <span class="c1"># Ausgabe in der Kommandozeile/Shell</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ADC:&quot;</span><span class="p">,</span> <span class="n">read</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E in Lux&quot;</span><span class="p">,</span> <span class="n">map_quat</span><span class="p">(</span><span class="n">read</span><span class="p">))</span>
</code></pre></div>
<hr />
<h4 id="tageslichtschaltungpy"><code>tageslichtschaltung.py</code></h4>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">l_set</span><span class="p">(</span><span class="n">p_act</span><span class="p">,</span> <span class="n">h_room</span><span class="p">,</span> <span class="n">PAR_SETPT</span><span class="p">,</span> <span class="n">l_man</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p_act</span> <span class="ow">and</span> <span class="n">h_room</span><span class="o">&lt;</span><span class="n">PAR_SETPT</span><span class="p">)</span> <span class="ow">or</span> <span class="n">l_man</span>
</code></pre></div>
<hr />
<h4 id="mappingspy"><code>mappings.py</code></h4>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">map_lin</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="n">E_max</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">E_min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">z_max</span> <span class="o">=</span> <span class="mi">65535</span>
    <span class="n">z_min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">beta_0</span> <span class="o">=</span> <span class="n">E_min</span>
    <span class="n">beta_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">E_max</span> <span class="o">-</span> <span class="n">E_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">z_max</span> <span class="o">-</span> <span class="n">z_min</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">beta_0</span> <span class="o">+</span> <span class="n">beta_1</span> <span class="o">*</span> <span class="n">z</span>

<span class="k">def</span> <span class="nf">map_quat</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">44000</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0015</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">)</span> <span class="o">**</span><span class="mi">2</span>
</code></pre></div>
<hr />
<h3 id="aufgabe-2_3_2"><img alt="‚úç" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/270d.svg" title=":writing_hand:" /> Aufgabe 2_3_2:</h3>
<ul>
<li>Welche Teile des Codes k√∂nnte man ebenfalls in Funktionen auslagern?</li>
<li>Wie sch√§tzen Sie den Aufwand ein, wenn man nun weitere Tageslicht-Schaltungen mit anderen LEDs und Sensoren auf der gleichen Platine realisieren m√∂chte?</li>
</ul>
<hr />
<h2 id="sichtbarkeit-von-variablen">Sichtbarkeit von Variablen</h2>
<hr />
<h3 id="lokale-variablen">Lokale Variablen</h3>
<ul>
<li>Variablen, die innerhalb einer Funktion definiert werden (z.B. <code>s</code>) sind au√üerhalb der Funktion nicht sichtbar (<em>Kapselung</em>)</li>
<li>Dies gilt f√ºr die meisten Programmiersprachen und z.B. auch f√ºr Schleifen</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">map_quat</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">44000</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0015</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">)</span> <span class="o">**</span><span class="mi">2</span>

<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="c1"># NameError Traceback (most recent call last)</span>
<span class="c1"># &lt;ipython-input-11-76c4dd40fb41&gt; in &lt;module&gt;</span>
<span class="c1"># ----&gt; 1 print(s)</span>

<span class="c1"># NameError: name &#39;s&#39; is not defined</span>
</code></pre></div>
<hr />
<h3 id="globale-variablen">Globale Variablen</h3>
<ul>
<li>Variablen, die (bewusst) √ºberall im Programmcode aufrufbar sind (z.B. <code>PAR_SETPT</code>) sind <strong>globale Variablen</strong></li>
<li>in Python werden globale Variablen in Gro√übuchstaben geschrieben</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">A_GLOBAL_VAR</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
  <span class="n">a_local_variable</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="k">return</span> <span class="n">a_local_variable</span>

<span class="n">another_variable</span> <span class="o">=</span> <span class="n">my_function</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A_GLOBAL_VAR</span><span class="p">)</span> <span class="c1"># 1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a_local_variable</span><span class="p">)</span> <span class="c1"># Error</span>
<span class="nb">print</span><span class="p">(</span><span class="n">another_variable</span><span class="p">)</span> <span class="c1"># 2</span>
</code></pre></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../2_2_Steuerung/" class="btn btn-neutral float-left" title="Steuerung"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../2_4_Objektorientierung/" class="btn btn-neutral float-right" title="Objektorientierung">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../2_2_Steuerung/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../2_4_Objektorientierung/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../javascripts/mathjax.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
